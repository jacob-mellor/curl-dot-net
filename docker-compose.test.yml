version: '3.8'

services:
  # Official httpbin image for local testing
  httpbin:
    image: kennethreitz/httpbin:latest
    container_name: curldotnet-httpbin
    ports:
      - "8080:80"
    environment:
      - GUNICORN_CMD_ARGS=--capture-output --error-logfile - --access-logfile - --access-logformat '%(h)s %(t)s %(r)s %(s)s Host %(f)s'
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:80/get"]
      interval: 5s
      timeout: 3s
      retries: 5
    restart: unless-stopped

  # HashiCorp's http-echo as a lightweight alternative
  echo-server:
    image: hashicorp/http-echo:latest
    container_name: curldotnet-echo
    ports:
      - "8081:5678"
    command: ["-text=hello world", "-listen=:5678"]
    healthcheck:
      test: ["CMD", "wget", "--spider", "-q", "http://localhost:5678"]
      interval: 5s
      timeout: 3s
      retries: 5
    restart: unless-stopped

  # WireMock for advanced mocking scenarios
  wiremock:
    image: wiremock/wiremock:latest
    container_name: curldotnet-wiremock
    ports:
      - "8082:8080"
    volumes:
      - ./tests/wiremock:/home/wiremock
    command: ["--verbose", "--global-response-templating"]
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/__admin/health"]
      interval: 5s
      timeout: 3s
      retries: 5
    restart: unless-stopped

# Network for test containers
networks:
  default:
    name: curldotnet-test-network
    driver: bridge